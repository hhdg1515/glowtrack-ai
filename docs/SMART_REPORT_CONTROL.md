# æ™ºèƒ½æŠ¥å‘Šæ§åˆ¶ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

GlowTrack AI çš„æ™ºèƒ½æŠ¥å‘Šæ§åˆ¶ç³»ç»Ÿä¼šè‡ªåŠ¨è¯„ä¼°æ²»ç–—æ•ˆæœï¼Œå¹¶æ ¹æ®æ•ˆæœç­‰çº§ã€æ—¶é—´çª—å£å’Œé£é™©å› ç´ ï¼Œæ™ºèƒ½æ§åˆ¶æŠ¥å‘Šçš„å¯è§æ€§å’Œåˆ†äº«æƒé™ã€‚

**æ ¸å¿ƒåŸåˆ™**: ä¿æŠ¤åŒ»ç¾è¯Šæ‰€å’Œæ‚£è€…åˆ©ç›Šï¼Œç»ä¸è®©è´Ÿé¢æŠ¥å‘Šå¤–æµã€‚

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### 1. è‡ªåŠ¨æ•ˆæœè¯„ä¼°

ç³»ç»Ÿè‡ªåŠ¨å°†æ²»ç–—æ•ˆæœåˆ†ä¸º 5 ä¸ªç­‰çº§ï¼š

| ç­‰çº§ | æ”¹å–„åº¦ | å¤„ç†æ–¹å¼ |
|------|--------|----------|
| **ä¼˜ç§€** | 50%+ | âœ… æ‚£è€…å¯è§å¯åˆ†äº«ï¼Œé¼“åŠ±ä¼ æ’­ |
| **è‰¯å¥½** | 30-50% | âœ… æ‚£è€…å¯è§å¯åˆ†äº« |
| **ä¸€èˆ¬** | 10-30% | âš ï¸ æ‚£è€…å¯è§ä½†ä¸å¯åˆ†äº« |
| **ä¸ä½³** | 0-10% | ğŸ”’ éœ€åŒ»ç”Ÿå®¡æ ¸æ‰èƒ½æ˜¾ç¤º |
| **è´Ÿé¢** | <0% | ğŸ”’ ä»…åŒ»ç”Ÿå¯è§ï¼Œæ‚£è€…å®Œå…¨çœ‹ä¸åˆ° |

### 2. æ—¶é—´çª—å£ä¿æŠ¤

```python
æ—¶é—´æ£€æŸ¥è§„åˆ™ï¼š
â”œâ”€â”€ < 14 å¤©ï¼šå¤ªæ—©ï¼Œæ•ˆæœæœªå®Œå…¨æ˜¾ç° â†’ æç¤º 2-4 å‘¨åå†æ‹
â”œâ”€â”€ 14-21 å¤©ï¼šå¯æ¥å—
â”œâ”€â”€ 21-90 å¤©ï¼šæœ€ä½³è¯„ä¼°æœŸ â­
â”œâ”€â”€ 90-180 å¤©ï¼šå¯æ¥å—ä½†æ•ˆæœå¯èƒ½å‡é€€
â””â”€â”€ > 180 å¤©ï¼šå¤ªæ™šï¼Œæ•ˆæœå·²æ¶ˆé€€ â†’ æç¤ºä»…ä¾›å‚è€ƒ
```

### 3. é£é™©æ£€æµ‹

è‡ªåŠ¨æ£€æµ‹ä»¥ä¸‹é£é™©ï¼š

- âŒ **é¢éƒ¨ä¸å¯¹ç§°åŠ é‡** (ä¸¥é‡ç­‰çº§: high)
- âŒ **ä¸è‡ªç„¶å¤–è§‚** (è‡ªç„¶åº¦ < 70)
- âŒ **è´Ÿé¢æ”¹å–„é¡¹ç›®** (ä»»ä½•æŒ‡æ ‡ä¸‹é™ > 5%)

### 4. åŒ»ç”Ÿæé†’ç³»ç»Ÿ

æ ¹æ®é£é™©ç­‰çº§è‡ªåŠ¨å‘é€æé†’ï¼š

```
ğŸš¨ ç´§æ€¥ (Urgent)
   â†’ é«˜é£é™©æƒ…å†µï¼Œç«‹å³é€šçŸ¥åŒ»ç”Ÿ
   â†’ å»ºè®®: é©¬ä¸Šè”ç³»æ‚£è€…å®‰æ’é¢è¯Š

âš ï¸  é‡è¦ (High)
   â†’ æ•ˆæœä¸ä½³æˆ–è´Ÿé¢
   â†’ å»ºè®®: è¯„ä¼°æ˜¯å¦éœ€è¦è¡¥æ‰“æˆ–ä¿®æ­£

â„¹ï¸  ä¿¡æ¯ (Info)
   â†’ æ—¶é—´å¤ªæ—©æˆ–å…¶ä»–æç¤º
   â†’ å»ºè®®: å®‰æ’åç»­å¤æŸ¥
```

---

## ğŸ“Š API ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1: ä¸Šä¼ ç…§ç‰‡å¹¶è‡ªåŠ¨æ§åˆ¶æŠ¥å‘Š

```bash
curl -X POST "http://localhost:8000/api/v1/analysis/analyze-upload" \
  -F "before_image=@before.jpg" \
  -F "after_image=@after.jpg" \
  -F "treatment_type=è‚‰æ¯’ç´ æ³¨å°„" \
  -F "treatment_date=2024-01-15"  # æ²»ç–—æ—¥æœŸï¼ˆISOæ ¼å¼ï¼‰
```

### ç¤ºä¾‹ 2: Python ä»£ç è°ƒç”¨

```python
import requests
from datetime import datetime, timedelta

# å‡è®¾æ²»ç–—åœ¨ 4 å‘¨å‰
treatment_date = (datetime.now() - timedelta(days=28)).isoformat()

files = {
    'before_image': open('before.jpg', 'rb'),
    'after_image': open('after.jpg', 'rb'),
}

data = {
    'treatment_type': 'è‚‰æ¯’ç´ æ³¨å°„',
    'treatment_date': treatment_date,
    'patient_id': 'P12345'
}

response = requests.post(
    'http://localhost:8000/api/v1/analysis/analyze-upload',
    files=files,
    data=data
)

result = response.json()

# æ£€æŸ¥æ‚£è€…èƒ½å¦çœ‹åˆ°æŠ¥å‘Š
if result['patient_report']:
    if result['patient_report']['can_view']:
        print(f"âœ… æ‚£è€…å¯è§: {result['patient_report']['headline']}")
    else:
        print(f"â³ å¾…å®¡æ ¸: {result['patient_report']['message']}")
else:
    print("ğŸ”’ ä»…åŒ»ç”Ÿå¯è§ï¼ˆæ•ˆæœä¸ä½³æˆ–æœ‰é£é™©ï¼‰")

# åŒ»ç”ŸæŸ¥çœ‹å®Œæ•´æ•°æ®
doctor_view = result['doctor_view']
print(f"\næ•ˆæœç­‰çº§: {doctor_view['effect_level']}")
print(f"å¯è§æ€§çŠ¶æ€: {doctor_view['visibility_status']}")

if doctor_view['risks']:
    print(f"\nâš ï¸  æ£€æµ‹åˆ° {len(doctor_view['risks'])} ä¸ªé£é™©:")
    for risk in doctor_view['risks']:
        print(f"  - [{risk['severity']}] {risk['message']}")

if doctor_view['alerts']:
    print(f"\nğŸ“¢ åŒ»ç”Ÿæé†’ ({len(doctor_view['alerts'])}):")
    for alert in doctor_view['alerts']:
        print(f"  - [{alert['level']}] {alert['message']}")
```

---

## ğŸ“± è¿”å›æ•°æ®ç»“æ„

### ä¼˜ç§€æ•ˆæœï¼ˆæ‚£è€…å¯è§å¯åˆ†äº«ï¼‰

```json
{
  "success": true,
  "patient_report": {
    "status": "available",
    "can_view": true,
    "can_share": true,
    "headline": "ğŸ‰ å¤ªæ£’äº†ï¼æ‚¨çš„æ²»ç–—æ•ˆæœéå¸¸æ˜¾è‘—",
    "badge": "â­ ä¼˜ç§€æ•ˆæœ",
    "encouragement": "æ‚¨çš„æ”¹å–„æ•ˆæœè¶…è¿‡äº†å¤§å¤šæ•°æ‚£è€…ï¼Œéå¸¸å€¼å¾—åˆ†äº«ï¼",
    "overall_improvement": 68,
    "highlights": [
      "é¢å¤´æ¨ªçº¹æ˜æ˜¾å‡å°‘ï¼Œæ·±åº¦é™ä½çº¦70%",
      "çš®è‚¤å…‰æ³½åº¦æ˜æ˜¾æå‡ï¼Œæ›´åŠ æ°´æ¶¦",
      "è‹¹æœè‚Œæ˜æ˜¾é¥±æ»¡ï¼Œé¢éƒ¨ç«‹ä½“æ„Ÿå¢å¼º"
    ],
    "next_steps": [
      "ç»§ç»­ä¿æŒè‰¯å¥½çš„æŠ¤ç†ä¹ æƒ¯",
      "6-8 ä¸ªæœˆåå¯è€ƒè™‘ç»´æŒæ€§æ²»ç–—",
      "æ¬¢è¿åˆ†äº«æ‚¨çš„ç¾ä¸½èœ•å˜"
    ]
  },
  "doctor_view": {
    "effect_level": "excellent",
    "visibility_status": "public_shareable",
    "risks": [],
    "alerts": [],
    "suggested_actions": [
      "request_testimonial",
      "offer_referral_discount"
    ]
  }
}
```

### ä¸€èˆ¬æ•ˆæœï¼ˆæ‚£è€…å¯è§ä¸å¯åˆ†äº«ï¼‰

```json
{
  "success": true,
  "patient_report": {
    "status": "available",
    "can_view": true,
    "can_share": false,  // âŒ ä¸å…è®¸åˆ†äº«
    "headline": "ğŸ’ª æ‚¨çš„æ²»ç–—æ­£åœ¨æŒç»­æ”¹å–„ä¸­",
    "badge": "â³ æŒç»­æ”¹å–„",
    "encouragement": "æ•ˆæœä»åœ¨æ˜¾ç°ï¼Œå»ºè®® 2 å‘¨åå†æ¬¡æ‹ç…§è§‚å¯Ÿ",
    "overall_improvement": 18,
    "highlights": [
      "çš®è‚¤å…‰æ³½åº¦æœ‰æ‰€æå‡",
      "æ•´ä½“è‚¤è‰²æ›´åŠ å‡åŒ€"
    ],
    "next_steps": [
      "æ•ˆæœä»åœ¨æŒç»­æ˜¾ç°ä¸­",
      "å»ºè®® 2-3 å‘¨åå†æ¬¡æ‹ç…§",
      "å¦‚æœ‰ç–‘é—®è¯·å’¨è¯¢æ‚¨çš„åŒ»ç”Ÿ"
    ]
  },
  "doctor_view": {
    "effect_level": "fair",
    "visibility_status": "patient_only",
    "suggested_actions": [
      "schedule_followup_2weeks",
      "send_care_instructions"
    ]
  }
}
```

### æ•ˆæœä¸ä½³ï¼ˆä»…åŒ»ç”Ÿå¯è§ï¼‰

```json
{
  "success": true,
  "patient_report": {
    "status": "pending_review",
    "can_view": false,  // âŒ æ‚£è€…çœ‹ä¸åˆ°
    "message": "æ‚¨çš„å¤æŸ¥ç…§ç‰‡å·²æ”¶åˆ°ï¼ŒåŒ»ç”Ÿå°†å¾ˆå¿«ä¸ºæ‚¨è¿›è¡Œä¸“ä¸šè¯„ä¼°"
  },
  "doctor_view": {
    "effect_level": "poor",
    "visibility_status": "doctor_review",
    "risks": [],
    "alerts": [
      {
        "level": "high",
        "type": "poor_outcome",
        "message": "æ²»ç–—æ•ˆæœpoorï¼Œéœ€è¦åŒ»ç”Ÿä»‹å…¥",
        "action": "contact_patient",
        "priority": 2,
        "suggestions": [
          "è¯„ä¼°æ˜¯å¦éœ€è¦è¡¥æ‰“",
          "æ£€æŸ¥æ˜¯å¦æœ‰ä¸è‰¯ååº”",
          "è€ƒè™‘è°ƒæ•´æ²»ç–—æ–¹æ¡ˆ"
        ]
      }
    ],
    "suggested_actions": [
      "offer_free_touch_up",  // æä¾›å…è´¹è¡¥æ‰“
      "schedule_followup"     // å®‰æ’å¤æŸ¥
    ]
  }
}
```

### è´Ÿé¢æ•ˆæœï¼ˆå®Œå…¨éšè—ï¼‰

```json
{
  "success": true,
  "patient_report": null,  // âŒ æ‚£è€…å®Œå…¨çœ‹ä¸åˆ°
  "doctor_view": {
    "effect_level": "negative",
    "visibility_status": "doctor_only",
    "risks": [
      {
        "type": "asymmetry_increased",
        "severity": "high",
        "message": "é¢éƒ¨å¯¹ç§°æ€§ä¸‹é™è¶…è¿‡ 10%",
        "action": "urgent_doctor_review"
      }
    ],
    "alerts": [
      {
        "level": "urgent",
        "message": "æ£€æµ‹åˆ°é¢éƒ¨ä¸å¯¹ç§°ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´",
        "priority": 1
      }
    ],
    "suggested_actions": [
      "urgent_doctor_contact",   // ç´§æ€¥è”ç³»
      "schedule_consultation",   // å®‰æ’é¢è¯Š
      "offer_free_correction",   // å…è´¹ä¿®æ­£
      "document_case"            // è®°å½•ç—…ä¾‹
    ]
  }
}
```

---

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### è°ƒæ•´æ•ˆæœé˜ˆå€¼

```python
from app.ai.report_controller import ReportController

controller = ReportController()

# è‡ªå®šä¹‰é˜ˆå€¼
controller.thresholds = {
    "excellent": 60,  # æé«˜ä¼˜ç§€æ ‡å‡†åˆ° 60%
    "good": 40,
    "fair": 15,
    "poor": 0,
}
```

### è°ƒæ•´æ—¶é—´çª—å£

```python
controller.timing = {
    "too_early_days": 10,      # ç¼©çŸ­åˆ° 10 å¤©
    "optimal_min_days": 14,
    "optimal_max_days": 120,   # å»¶é•¿åˆ° 120 å¤©
    "too_late_days": 240,
}
```

---

## ğŸ›¡ï¸ æœ€ä½³å®è·µ

### 1. å§‹ç»ˆè®¾ç½®æ²»ç–—æ—¥æœŸ

```python
# âœ… å¥½
data = {
    'treatment_date': '2024-01-15'  # ç²¾ç¡®çš„æ²»ç–—æ—¥æœŸ
}

# âŒ å·®
data = {}  # ç³»ç»Ÿä¼šå‡è®¾ 28 å¤©å‰ï¼Œä¸å‡†ç¡®
```

### 2. å¤„ç†åŒ»ç”Ÿæé†’

```python
result = api_call(...)

# æ£€æŸ¥å¹¶å¤„ç†æé†’
for alert in result['doctor_view']['alerts']:
    if alert['level'] == 'urgent':
        send_sms_to_doctor(alert['message'])
    elif alert['level'] == 'high':
        send_email_to_doctor(alert['message'])
```

### 3. æ ¹æ®å»ºè®®é‡‡å–è¡ŒåŠ¨

```python
actions = result['doctor_view']['suggested_actions']

if 'urgent_doctor_contact' in actions:
    # ç«‹å³é€šçŸ¥åŒ»ç”Ÿå¹¶è”ç³»æ‚£è€…
    notify_doctor_urgent()
    schedule_immediate_consultation()

elif 'offer_free_touch_up' in actions:
    # è‡ªåŠ¨å‘é€å…è´¹è¡¥æ‰“ä¼˜æƒ åˆ¸
    send_touchup_coupon(patient_id)

elif 'request_testimonial' in actions:
    # æ•ˆæœä¼˜ç§€ï¼Œè¯·æ±‚å¥½è¯„
    send_review_request(patient_id)
```

---

## ğŸ“ˆ ç›‘æ§å’Œåˆ†æ

### æŸ¥çœ‹æ•ˆæœåˆ†å¸ƒ

```python
from collections import Counter

# ç»Ÿè®¡æ•ˆæœç­‰çº§åˆ†å¸ƒ
effect_levels = [
    result['doctor_view']['effect_level']
    for result in all_analyses
]

distribution = Counter(effect_levels)
print(distribution)
# Counter({'excellent': 120, 'good': 45, 'fair': 18, 'poor': 5, 'negative': 2})
```

### ç›‘æ§é£é™©ç‡

```python
total_analyses = len(all_results)
risky_cases = sum(
    1 for r in all_results
    if r['doctor_view']['risks']
)

risk_rate = risky_cases / total_analyses * 100
print(f"é£é™©ç‡: {risk_rate:.1f}%")

# å¦‚æœé£é™©ç‡è¿‡é«˜ï¼Œéœ€è¦æ£€æŸ¥:
# 1. æ²»ç–—æŠ€æœ¯æ˜¯å¦éœ€è¦æ”¹è¿›
# 2. æ‚£è€…ç­›é€‰æ˜¯å¦åˆç†
# 3. æœ¯åæŠ¤ç†æŒ‡å¯¼æ˜¯å¦åˆ°ä½
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q: æ‚£è€…çœ‹ä¸åˆ°æŠ¥å‘Šæ€ä¹ˆåŠï¼Ÿ

A: è¿™æ˜¯ç³»ç»Ÿä¿æŠ¤æœºåˆ¶ã€‚æ£€æŸ¥ `doctor_view` ä¸­çš„æé†’å’Œå»ºè®®ï¼š

```python
if not result['patient_report']:
    # æŸ¥çœ‹åŸå› 
    visibility = result['doctor_view']['visibility_status']

    if visibility == 'doctor_only':
        # æ•ˆæœä¸ä½³æˆ–æœ‰é£é™©ï¼ŒåŒ»ç”Ÿéœ€ä¸»åŠ¨è”ç³»æ‚£è€…
        print("éœ€è¦åŒ»ç”Ÿä»‹å…¥å¤„ç†")

    elif visibility == 'doctor_review':
        # ç­‰å¾…åŒ»ç”Ÿå®¡æ ¸
        print("åŒ»ç”Ÿå®¡æ ¸åå†³å®šæ˜¯å¦æ˜¾ç¤º")
```

### Q: å¦‚ä½•ä¿®æ”¹æŠ¥å‘Šè®©æ‚£è€…çœ‹åˆ°ï¼Ÿ

A: **ä¸å»ºè®®å¼ºåˆ¶æ˜¾ç¤ºè´Ÿé¢æŠ¥å‘Š**ã€‚æ­£ç¡®åšæ³•ï¼š

1. åŒ»ç”Ÿè¯„ä¼°å®é™…æƒ…å†µ
2. å¦‚æœç¡®å®æ•ˆæœä¸ä½³ â†’ å…è´¹è¡¥æ‰“/ä¿®æ­£
3. è¡¥æ•‘åé‡æ–°æ‹ç…§åˆ†æ
4. æ–°æŠ¥å‘Šä¼šè‡ªåŠ¨æ˜¾ç¤º

### Q: æ—¶é—´å¤ªæ—©æ€ä¹ˆåŠï¼Ÿ

A: ç³»ç»Ÿä¼šæç¤ºæ‚£è€… 2-4 å‘¨åå†æ‹ï¼š

```python
if result['doctor_view']['timing_status']['status'] == 'too_early':
    # ç»™æ‚£è€…å‘æ¶ˆæ¯
    message = result['doctor_view']['timing_status']['recommendation']
    send_patient_message(message)
```

---

## ğŸ“ è¿›é˜¶åº”ç”¨

### è‡ªåŠ¨åŒ–å·¥ä½œæµ

```python
class AutomatedWorkflow:
    """è‡ªåŠ¨åŒ–å¤„ç†æµç¨‹"""

    def process_analysis_result(self, result):
        """æ ¹æ®åˆ†æç»“æœè‡ªåŠ¨å¤„ç†"""

        visibility = result['doctor_view']['visibility_status']
        actions = result['doctor_view']['suggested_actions']

        # ä¼˜ç§€æ•ˆæœ â†’ è‡ªåŠ¨åŒ–å¥½è¯„è¯·æ±‚
        if visibility == 'public_shareable':
            self.send_review_request()
            self.generate_social_media_post()

        # ä¸€èˆ¬æ•ˆæœ â†’ è‡ªåŠ¨å®‰æ’å¤æŸ¥
        elif visibility == 'patient_only':
            self.schedule_followup_in_2weeks()

        # éœ€å®¡æ ¸ â†’ é€šçŸ¥åŒ»ç”Ÿ
        elif visibility == 'doctor_review':
            self.notify_doctor_for_review()

        # ä»…åŒ»ç”Ÿå¯è§ â†’ ç´§æ€¥å¤„ç†
        elif visibility == 'doctor_only':
            self.urgent_doctor_notification()
            self.prepare_correction_plan()
```

---

**è®© AI æˆä¸ºåŒ»ç¾è¯Šæ‰€çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œè€Œä¸æ˜¯é£é™©ï¼** ğŸš€
