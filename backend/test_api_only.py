"""
æµ‹è¯• Claude API è¿æ¥ï¼ˆä¸éœ€è¦çœŸå®ç…§ç‰‡ï¼‰
"""

import os
import anthropic


def test_claude_connection():
    """åªæµ‹è¯• API è¿æ¥ï¼Œä¸éœ€è¦ç…§ç‰‡"""

    print("=" * 60)
    print("æµ‹è¯• Claude API è¿æ¥")
    print("=" * 60)

    # è·å– API Key
    api_key = os.getenv("CLAUDE_API_KEY")

    if not api_key:
        print("\nâŒ è¯·å…ˆè®¾ç½®ç¯å¢ƒå˜é‡:")
        print("   Windows: set CLAUDE_API_KEY=sk-ant-api03-xxx")
        print("   Mac/Linux: export CLAUDE_API_KEY=sk-ant-api03-xxx")
        return

    print(f"\nâœ… API Key: {api_key[:20]}...")

    try:
        # åˆ›å»º Claude å®¢æˆ·ç«¯
        client = anthropic.Anthropic(api_key=api_key)

        print("\nğŸ”Œ è¿æ¥ Claude API...")

        # å‘é€ç®€å•çš„æµ‹è¯•æ¶ˆæ¯
        message = client.messages.create(
            model="claude-3-5-sonnet-20241022",
            max_tokens=200,
            messages=[
                {
                    "role": "user",
                    "content": """ä½ æ˜¯ä¸€ä¸ªåŒ»ç¾ AI é¡¾é—®ã€‚è¯·ç”¨ä¸­æ–‡ç®€çŸ­å›ç­”ï¼š

é—®é¢˜ï¼šå¦‚æœä¸€ä¸ªæ‚£è€…åšäº†è‚‰æ¯’ç´ æ³¨å°„ï¼Œæœ¯å‰é¢å¤´çº¹è¯„åˆ† 45 åˆ†ï¼Œæœ¯åè¯„åˆ† 78 åˆ†ï¼Œè¯·è®¡ç®—æ”¹å–„ç™¾åˆ†æ¯”å¹¶ç»™å‡ºä¸“ä¸šè¯„ä»·ã€‚

è¯·è¿”å› JSON æ ¼å¼ï¼š
{
  "improvement_pct": XX,
  "evaluation": "ç®€çŸ­è¯„ä»·"
}"""
                }
            ]
        )

        # è·å–å›å¤
        response = message.content[0].text
        tokens = message.usage.input_tokens + message.usage.output_tokens
        cost = (message.usage.input_tokens / 1_000_000 * 3) + (message.usage.output_tokens / 1_000_000 * 15)

        print("\nâœ… API è¿æ¥æˆåŠŸ!")
        print(f"\nğŸ“ Claude å›å¤:")
        print(response)
        print(f"\nğŸ’° ä½¿ç”¨ä¿¡æ¯:")
        print(f"   Tokens: {tokens}")
        print(f"   æˆæœ¬: ${cost:.4f}")

        print("\n" + "=" * 60)
        print("ğŸ‰ æµ‹è¯•é€šè¿‡ï¼Claude API å·¥ä½œæ­£å¸¸")
        print("=" * 60)

    except anthropic.APIError as e:
        print(f"\nâŒ API é”™è¯¯: {e}")
    except Exception as e:
        print(f"\nâŒ æœªçŸ¥é”™è¯¯: {e}")
        import traceback
        traceback.print_exc()


def explain_workflow():
    """è§£é‡Šå®é™…ä½¿ç”¨æµç¨‹"""

    print("\n" + "=" * 60)
    print("ğŸ“š GlowTrack AI å®é™…ä½¿ç”¨æµç¨‹")
    print("=" * 60)

    print("""
ğŸ¥ åœºæ™¯ï¼šæ‚£è€…æ¥è¯Šæ‰€åšè‚‰æ¯’ç´ é™¤çš±

ç¬¬ 1 æ­¥: æœ¯å‰æ‹ç…§ (æ²»ç–—å½“å¤©)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘© æ‚£è€…: å¼ å°å§ï¼Œ35å²ï¼Œé¢å¤´çº¹æ˜æ˜¾
ğŸ“¸ åŒ»ç”Ÿ: ä½¿ç”¨ App æ‹æ‘„æœ¯å‰ç…§ç‰‡
   - æ­£é¢ç…§
   - ä¾§é¢ç…§
   - é¢å¤´ç‰¹å†™

âœ… ç³»ç»Ÿè‡ªåŠ¨ä¿å­˜å¹¶æ ‡è®°ä¸º "æœ¯å‰ç…§ç‰‡"


ç¬¬ 2 æ­¥: è¿›è¡Œæ²»ç–—
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’‰ åŒ»ç”Ÿç»™å¼ å°å§æ³¨å°„è‚‰æ¯’ç´ 
   - é¢å¤´åŒºåŸŸ
   - çœ‰é—´åŒºåŸŸ
   - çœ¼å‘¨åŒºåŸŸ


ç¬¬ 3 æ­¥: æœ¯åæ‹ç…§ (4-6å‘¨åå¤æŸ¥)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“¸ åŒ»ç”Ÿ: å†æ¬¡æ‹æ‘„ï¼ˆåŒæ ·è§’åº¦å’Œå…‰çº¿ï¼‰

âœ… ç³»ç»Ÿ AR è¾…åŠ©ç¡®ä¿è§’åº¦ä¸€è‡´


ç¬¬ 4 æ­¥: AI åˆ†æå¯¹æ¯”
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¤– åŒ»ç”Ÿç‚¹å‡» "ç”Ÿæˆ AI åˆ†ææŠ¥å‘Š"

ç³»ç»Ÿè‡ªåŠ¨ï¼š
1ï¸âƒ£ å–å‡ºæœ¯å‰ç…§ç‰‡ (before.jpg)
2ï¸âƒ£ å–å‡ºæœ¯åç…§ç‰‡ (after.jpg)
3ï¸âƒ£ è°ƒç”¨ Claude API åˆ†æ
4ï¸âƒ£ ç”Ÿæˆä¸“ä¸šæŠ¥å‘Šï¼š

   ğŸ“Š åˆ†æç»“æœï¼š
   âœ… é¢å¤´çº¹å‡å°‘: 73%
   âœ… çœ‰é—´çº¹æ”¹å–„: 88%
   âœ… é±¼å°¾çº¹å‡è½»: 60%
   âœ… çš®è‚¤å…‰æ³½æå‡: 37%
   âœ… ç»¼åˆæ”¹å–„åº¦: 68%


ç¬¬ 5 æ­¥: ç”ŸæˆæŠ¥å‘Š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“„ åŒ»ç”Ÿç‰ˆæŠ¥å‘Š (è¯¦ç»†æ•°æ®)
   - æ‰€æœ‰é‡åŒ–æŒ‡æ ‡
   - ä¸“ä¸šåŒ»å­¦æœ¯è¯­
   - æ²»ç–—å»ºè®®

ğŸ“± æ‚£è€…ç‰ˆæŠ¥å‘Š (ç²¾ç¾å¯åˆ†äº«)
   - å¯è§†åŒ–å¯¹æ¯”å›¾
   - é€šä¿—æ˜“æ‡‚çš„è¯´æ˜
   - ç¤¾äº¤åª’ä½“ä¼˜åŒ–

ğŸ’¬ å¼ å°å§åˆ†äº«åˆ°æœ‹å‹åœˆ
   "çœ‹çœ‹æˆ‘çš„å˜åŒ–ï¼åŒ»ç¾æ•ˆæœå¤ªæƒŠè‰³äº† âœ¨"

ğŸ¯ è¯Šæ‰€è·å¾—å£ç¢‘ä¼ æ’­ï¼
    """)

    print("=" * 60)


if __name__ == "__main__":
    # å…ˆè§£é‡Šæµç¨‹
    explain_workflow()

    # ç„¶åæµ‹è¯• API
    input("\næŒ‰ Enter é”®æµ‹è¯• Claude API è¿æ¥...")
    test_claude_connection()
